
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#2196f3">
  <script src="_static/javascripts/modernizr.js"></script>
  
  
    <link rel="apple-touch-icon" href="_static/images/apple-icon-152x152.png"/>
  
  
    <title>Introduction &#8212; domid  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/material.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="About DomId" href="about_link.html" />
    <link rel="prev" title="Welcome to DomId’s documentation!" href="index.html" />
  
    <link rel="apple-touch-icon" href="_static/images/apple-icon-152x152.png"/>
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=teal data-md-color-accent=cyan>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#readme_link" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="index.html" title="domid  documentation"
           class="md-header-nav__button md-logo">
          
            <i class="md-icon">school</i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">DomId</span>
          <span class="md-header-nav__topic"> Introduction </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/agisga/DomId" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    DomId
  </div>
</a>
          </div>
        </div>
      
      
    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
            
            <li class="md-tabs__item"><a href="about_link.html" class="md-tabs__link">About</a></li>
            
            <li class="md-tabs__item"><a href="#" class="md-tabs__link">Quick Start</a></li>
            
            <li class="md-tabs__item"><a href="addnew_link.html" class="md-tabs__link">Custom Datasets and Models</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="index.html" title="domid documentation" class="md-nav__button md-logo">
      
        <i class="md-icon">school</i>
      
    </a>
    <a href="index.html"
       title="domid documentation">DomId</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/agisga/DomId" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    DomId
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Introduction and Quick Start guide:</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Introduction </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Introduction</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#readme-link--page-root" class="md-nav__link">Introduction</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#domain-identification-domid-a-suite-of-deep-unsupervised-clustering-algorithms" class="md-nav__link">Domain Identification (DomId): A suite of deep unsupervised clustering algorithms</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#installation" class="md-nav__link">Installation</a>
        </li>
        <li class="md-nav__item"><a href="#usage" class="md-nav__link">Usage</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#vade-model" class="md-nav__link">VaDE model</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#applying-vade-to-mnist" class="md-nav__link">Applying VaDE to MNIST</a>
        </li>
        <li class="md-nav__item"><a href="#applying-vade-to-color-mnist" class="md-nav__link">Applying VaDE to Color-MNIST</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#dec-model" class="md-nav__link">DEC model</a>
        </li>
        <li class="md-nav__item"><a href="#custom-datasets" class="md-nav__link">Custom datasets</a>
        </li>
        <li class="md-nav__item"><a href="#cdvade-model" class="md-nav__link">CDVaDE model</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#training-cvade" class="md-nav__link">Training CVaDE:</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#sdcn-and-modified-sdcn-for-wsi-data" class="md-nav__link">SDCN, and modified SDCN for WSI data</a>
        </li>
        <li class="md-nav__item"><a href="#simultaneous-unsupervised-clustering-and-supervised-classification" class="md-nav__link">Simultaneous unsupervised clustering and supervised classification</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#m2yd-model" class="md-nav__link">M2YD model</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#references" class="md-nav__link">References</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="#domain-identification-domid-a-suite-of-deep-unsupervised-clustering-algorithms" class="md-nav__link">Domain Identification (DomId): A suite of deep unsupervised clustering algorithms</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="#references" class="md-nav__link">References</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">More information about the models:</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="about_link.html" class="md-nav__link">About DomId</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Datasets and Tasks</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="domid.dsets.html" class="md-nav__link">domid.dsets package</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="domid.tasks.html" class="md-nav__link">domid.tasks package</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Models</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="domid.compos.html" class="md-nav__link">domid.compos package</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="domid.models.html" class="md-nav__link">domid.models package</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Training a Model</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="domid.algos.html" class="md-nav__link">domid.algos package</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="domid.trainers.html" class="md-nav__link">domid.trainers package</a>
      
    
    </li>
    <li class="md-nav__item">
    
      <span class="md-nav__link caption"><span class="caption-text">Utilities</span></span>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="domid.utils.html" class="md-nav__link">domid.utils package</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#readme-link--page-root" class="md-nav__link">Introduction</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#domain-identification-domid-a-suite-of-deep-unsupervised-clustering-algorithms" class="md-nav__link">Domain Identification (DomId): A suite of deep unsupervised clustering algorithms</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#installation" class="md-nav__link">Installation</a>
        </li>
        <li class="md-nav__item"><a href="#usage" class="md-nav__link">Usage</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#vade-model" class="md-nav__link">VaDE model</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#applying-vade-to-mnist" class="md-nav__link">Applying VaDE to MNIST</a>
        </li>
        <li class="md-nav__item"><a href="#applying-vade-to-color-mnist" class="md-nav__link">Applying VaDE to Color-MNIST</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#dec-model" class="md-nav__link">DEC model</a>
        </li>
        <li class="md-nav__item"><a href="#custom-datasets" class="md-nav__link">Custom datasets</a>
        </li>
        <li class="md-nav__item"><a href="#cdvade-model" class="md-nav__link">CDVaDE model</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#training-cvade" class="md-nav__link">Training CVaDE:</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#sdcn-and-modified-sdcn-for-wsi-data" class="md-nav__link">SDCN, and modified SDCN for WSI data</a>
        </li>
        <li class="md-nav__item"><a href="#simultaneous-unsupervised-clustering-and-supervised-classification" class="md-nav__link">Simultaneous unsupervised clustering and supervised classification</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#m2yd-model" class="md-nav__link">M2YD model</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#references" class="md-nav__link">References</a>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="introduction">
<h1 id="readme-link--page-root">Introduction<a class="headerlink" href="#readme-link--page-root" title="Permalink to this heading">¶</a></h1>
<section class="tex2jax_ignore mathjax_ignore" id="domain-identification-domid-a-suite-of-deep-unsupervised-clustering-algorithms">
<h2 id="domain-identification-domid-a-suite-of-deep-unsupervised-clustering-algorithms">Domain Identification (DomId): A suite of deep unsupervised clustering algorithms<a class="headerlink" href="#domain-identification-domid-a-suite-of-deep-unsupervised-clustering-algorithms" title="Permalink to this heading">¶</a></h2>
<p><img alt="GH Actions CI " src="https://github.com/DIDSR/DomId/actions/workflows/ci.yml/badge.svg"/></p>
<p>DomId is a Python package offering a PyTorch-based suite of unsupervised deep clustering algorithms. The primary goal is to identify subgroups that have not been previously annotated within image datasets.</p>
<p>Some of the implemented models are the Variational Deep Embedding (VaDE) model [Jiang et al., 2017], Conditionally Decoded Variational Deep Embedding (CDVaDE) [Sidulova et al., 2023], Deep Embedding Clustering (DEC) [Xie et al., 2016], Structural Deep Clustering Network (SDCN) [Bo et al., 2020].
These clustering algorithms include a feature extractor component, which can be either an Autoencoders (AE) or a Variational Autoencoder (VAE). The package provides multiple AE and VAE architectures to choose from and includes instructions for extending the package with custom neural network architectures or clustering algorithms.</p>
<p>Experiment tutorials in Jupyter notebooks are available for both the MNIST dataset and a digital pathology dataset.</p>
<p>By adopting a highly modular design, the codebase prioritizes straightforward extensibility, so that new models, datasets or tasks can be added with ease.
The software design of DomId follows the design principles of <a class="reference external" href="https://github.com/marrlab/DomainLab">DomainLab</a>, which is a modular Python package for training domain invariant neural networks and has been used to develop DomId.</p>
<section id="installation">
<h3 id="installation">Installation<a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h3>
<ol class="arabic simple" start="0">
<li><p>Prerequisites:</p>
<ul class="simple">
<li><p>This Python package uses <a class="reference external" href="https://python-poetry.org/">Poetry</a> for dependency management and various package development workflows. To install Poetry see: <a class="reference external" href="https://python-poetry.org/docs/#installation">https://python-poetry.org/docs/#installation</a>.</p></li>
<li><p>A workflow without Poetry is also possible, but it is currently not recommended. For a workflow without Poetry, dependencies can be installed from the <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file.</p></li>
</ul>
</li>
<li><p>Clone this repository, e.g.,</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/agisga/DomId.git
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Install the <code class="docutils literal notranslate"><span class="pre">DomId</span></code> package and all its dependencies with:</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>poetry install
</pre></div>
</div>
</section>
<section id="usage">
<h3 id="usage">Usage<a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h3>
<p>The following examples demonstrate how to use the DomId Python package directly from your command line. You can also leverage its API within your Python scripts or notebooks for greater flexibility. For in-depth tutorials and case studies, please refer to the <a class="reference external" href="https://github.com/DIDSR/DomId/tree/main/notebooks"><code class="docutils literal notranslate"><span class="pre">notebooks</span></code> directory</a>.</p>
<section id="vade-model">
<h4 id="vade-model">VaDE model<a class="headerlink" href="#vade-model" title="Permalink to this heading">¶</a></h4>
<p>The deep unsupervised clustering model VaDE has been proposed in [1].</p>
<section id="applying-vade-to-mnist">
<h5 id="applying-vade-to-mnist">Applying VaDE to MNIST<a class="headerlink" href="#applying-vade-to-mnist" title="Permalink to this heading">¶</a></h5>
<p>For examle, to cluster digits 0-4 of the MNIST dataset with the VaDE model proposed in [Jiang et al. 2017] using CNN encoder and decoder architectures with a 200-dimensional latent space:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>poetry run python main_out.py --te_d 0 --tr_d 0 1 2 3 4 --task=mnist --epos=10 --aname=vade --zd_dim=200 --d_dim=5 --apath=domid/algos/builder_vade.py --split 0.8 --bs 100 --pre_tr 5 --lr 0.00005 --model cnn
</pre></div>
</div>
<p>The output metrics and confusion matrices assess how well the identified clusters correspond to the digit labels:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(...)
Epoch 10. ELBO loss
pi:
[0.14428806 0.22498095 0.1877629  0.24480581 0.19816224]
epoch: 10
pooled train clustering acc:  0.7213934426229508
[[3407    0   13    2    2]
 [   0 5203   31   61   20]
 [  18  104 1243 1293    7]
 [1266   24 3204 3299  178]
 [  34   46  265  230 4450]]
clustering validation acc:  0.7236065573770492
[[ 848    0    1    6    0]
 [   0 1305   13    8    8]
 [   7   26  340  311    3]
 [ 316    4  816  813   44]
 [   9   10   53   51 1108]]
</pre></div>
</div>
</section>
<section id="applying-vade-to-color-mnist">
<h5 id="applying-vade-to-color-mnist">Applying VaDE to Color-MNIST<a class="headerlink" href="#applying-vade-to-color-mnist" title="Permalink to this heading">¶</a></h5>
<ul class="simple">
<li><p>To apply VaDE to the color-MNIST dataset:</p></li>
</ul>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>poetry run python main_out.py --te_d 0 --tr_d 0 1 2 3 4 5 6 7 8 9 --task=mnistcolor10 --debug --epos=20 --pre_tr=10 --aname=vade --zd_dim=50 --d_dim=10 --apath=domid/algos/builder_vade.py --model cnn
</pre></div>
</div>
<p>The output metrics and confusion matrices assess how well the identified clusters correspond to the different colors:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(...)
Epoch 20. ELBO loss
pi:
[0.09958664 0.09956316 0.09337884 0.0995345  0.04938212 0.09954792
 0.2096352  0.09956467 0.09960268 0.05020422]
epoch: 20
pooled train clustering acc:  0.7561666666666667
[[600   0   0   0   0   0   0   0   0   0]
 [  0 600   0   0   0   0   0   0   0   0]
 [  0   0   0   0   0   0   0   0   0   0]
 [  0   0   0 600   0   0   0   0   0   0]
 [  0   0   0   0   0   0   0   0   0 262]
 [  0   0   0   0   0 599   0   0   0   0]
 [  0   0 600   0 600   1 600   0   0   0]
 [  0   0   0   0   0   0   0 600   0   0]
 [  0   0   0   0   0   0   0   0 600   0]
 [  0   0   0   0   0   0   0   0   0 338]]
clustering validation acc:  0.7568333333333334
[[600   0   0   0   0   0   0   0   0   0]
 [  0 600   0   0   0   0   0   0   0   0]
 [  0   0   0   0   0   0   0   0   0   0]
 [  0   0   0 600   0   0   0   0   0   0]
 [  0   0   0   0   0   0   0   0   0 259]
 [  0   0   0   0   0 600   0   0   0   0]
 [  0   0 600   0 600   0 600   0   0   0]
 [  0   0   0   0   0   0   0 600   0   0]
 [  0   0   0   0   0   0   0   0 600   0]
 [  0   0   0   0   0   0   0   0   0 341]]
</pre></div>
</div>
</section>
</section>
<section id="dec-model">
<h4 id="dec-model">DEC model<a class="headerlink" href="#dec-model" title="Permalink to this heading">¶</a></h4>
<p>To apply a DEC model, that is described in the paper [3], to MNIST dataset:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>poetry run python main_out.py --te_d 0 --tr_d 0 1 2 3 4 5 6 7 8 9 --task=mnist10 --debug --epos=20 --pre_tr=10 --aname=dec --zd_dim=50 --d_dim=10 --apath=domid/algos/builder_dec.py --model cnn
</pre></div>
</div>
<p>Note: there is no conditioning on the labels in the DEC model.</p>
</section>
<section id="custom-datasets">
<h4 id="custom-datasets">Custom datasets<a class="headerlink" href="#custom-datasets" title="Permalink to this heading">¶</a></h4>
<p>To apply a deep clustering model, such as VaDE, to a custom (e.g., your own) dataset one needs to define a dataset class and a task class. For example, for the “HER2” dataset used in [xxxx 2023] the respective python files are <code class="docutils literal notranslate"><span class="pre">domid/dsets/dset_her2.py</span></code> and <code class="docutils literal notranslate"><span class="pre">domid/tasks/task_her2.py</span></code>. Finally, the defined new task should be added in the chain defined in <code class="docutils literal notranslate"><span class="pre">domid/tasks/zoo_tasks.py</span></code>. For example, with the defined “HER2” dataset and task, the following command would apply the VaDE model to the “HER2” dataset:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>poetry run python main_out.py --te_d 0 --tr_d 0 1 2 --task=her2 --debug --epos=30 --aname=vade --zd_dim=250 --d_dim=3 --apath=domid/algos/builder_vade.py --L=5 --pre_tr=10 --dpath "/path/to/HER2/combined_train" --split 0.8 --bs 2 --lr 0.00005 --prio Gaus --model cnn
</pre></div>
</div>
</section>
<section id="cdvade-model">
<h4 id="cdvade-model">CDVaDE model<a class="headerlink" href="#cdvade-model" title="Permalink to this heading">¶</a></h4>
<p>The Conditionally Decoded VaDE model (CDVaDE) has been proposed in [4].</p>
<section id="training-cvade">
<h5 id="training-cvade">Training CVaDE:<a class="headerlink" href="#training-cvade" title="Permalink to this heading">¶</a></h5>
<p>In order to train the CVaDE model, the following command can be used:</p>
<ul class="simple">
<li><p>Generate csv file for the dataset, with the following columns: <code class="docutils literal notranslate"><span class="pre">image_id</span></code>, <code class="docutils literal notranslate"><span class="pre">label</span></code>, <code class="docutils literal notranslate"><span class="pre">domain_label</span></code>.
The <code class="docutils literal notranslate"><span class="pre">image_id</span></code> column should contain the path to the image, the <code class="docutils literal notranslate"><span class="pre">label</span></code> column should contain the label of the image,
and the <code class="docutils literal notranslate"><span class="pre">domain_label</span></code> column should contain the domain label of the image. The <code class="docutils literal notranslate"><span class="pre">domain_label</span></code> column is optional,
and if it is not present, the CVaDE model will be trained without domain labels.
Note: that the name of the columns could be different, but the values can only be integers.</p></li>
<li><p>The csv file should be stored in the root <code class="docutils literal notranslate"><span class="pre">data</span></code> directory (same as <code class="docutils literal notranslate"><span class="pre">zd_path</span></code>).</p></li>
<li><p>If csv file is in a differente directory the path can be specified in the <code class="docutils literal notranslate"><span class="pre">--csv_file</span></code> command line argument.</p></li>
<li><p>Injected variable and the dimentions of the injected variable should be specified in the <code class="docutils literal notranslate"><span class="pre">--inject_var</span></code> and <code class="docutils literal notranslate"><span class="pre">--dim_inject_y</span></code> command line argument.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--inject_var</span></code> argument should be a string matching the name of one of the columns in the generated dataframe.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--dim_inject_y</span></code> argument should be an integer specifying the number of unique values in the column specified in the <code class="docutils literal notranslate"><span class="pre">--inject_var</span></code> argument.</p></li>
</ul>
<p>For example, to train the CVaDE model on the Color-MNIST dataset with injection of color labels, the following command can be used:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>poetry run python main_out.py --te_d 0 --tr_d 0 1 2 3 4 --task=mnistcolor10 --epos=20 --aname=vade --zd_dim=20 --d_dim=5 --apath=domid/algos/builder_vade.py --L=5 --pre_tr=9 --bs 2 --lr 0.00005 --split 0.8 --prior Gaus --model cnn --inject_var "color" --dim_inject_y 5

</pre></div>
</div>
<p>For color-MNIST csv file is generated automatically in the <code class="docutils literal notranslate"><span class="pre">a_dset_mnist_color_rgb_solo.py</span></code>.
For other datasets, the csv file should be generated manually.</p>
<p>Assuming that there is a generated csv for HER2 dataset in the <code class="docutils literal notranslate"><span class="pre">"../HER2/combined_train/"</span></code> (note: the code for generating csv for HER2 can be found in <code class="docutils literal notranslate"><span class="pre">dset</span></code> folder), CDVaDE can be trained with the following command:
The injected variable is the class of the image, and the number of unique values in the class column is 3.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>poetry run python main_out.py --te_d 0 --tr_d 0 1 2 --task=her2 --epos=20 --aname=vade --zd_dim=20 --d_dim=3 --apath=domid/algos/builder_vade.py --L=5 --pre_tr=9 --bs 2 --lr 0.00005 --split 0.8 --prior Gaus --model cnn --inject_var "class" --dim_inject_y 3 --dpath "../HER2/combined_train/"
</pre></div>
</div>
</section>
</section>
<section id="sdcn-and-modified-sdcn-for-wsi-data">
<h4 id="sdcn-and-modified-sdcn-for-wsi-data">SDCN, and modified SDCN for WSI data<a class="headerlink" href="#sdcn-and-modified-sdcn-for-wsi-data" title="Permalink to this heading">¶</a></h4>
<p>SDCN is a deep neural network model that combines GCN and AE architectures for the purpose of unsupervised clustering.[5]</p>
<p>However, original SDCN model faces significant scalability challenges that hinder its deployment in digital pathology,
particularly when dealing with whole-slide digital pathology images (WSI), which are typically of gigapixel size or larger.
This limitation arises from SDCN need for constructing a graph on the entire dataset and the imperative to process all data in a single
batch during training. To overcome this issue, we propose batching strategy to the SDCN training process and introduce
a novel batching approach tailored specifically for WSI data.[6]</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>poetry run python main_out.py --te_d 0 --tr_d 0 1 2 3 4 5 6 7 8 9 --task=mnistcolor10 --epos=30 --aname=ae --zd_dim=20 --d_dim=10 --apath=domid/algos/builder_AE.py --L=5 --pre_tr=2 --bs 600 --lr 0.0001 --model cnn --nocu
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>poetry run python main_out.py --te_d 0 --tr_d 0 1 2 3 4 5 6 7 8 9 --task=mnistcolor10 --epos=30 --aname=sdcn --zd_dim=20 --d_dim=10 --apath=domid/algos/builder_sdcn.py --L=5 --pre_tr=2 --bs 600 --lr 0.0001 --model cnn --pre_tr_weight_path 'path/to/pretrained_weights/folder/' --nocu

</pre></div>
</div>
</section>
<section id="simultaneous-unsupervised-clustering-and-supervised-classification">
<h4 id="simultaneous-unsupervised-clustering-and-supervised-classification">Simultaneous unsupervised clustering and supervised classification<a class="headerlink" href="#simultaneous-unsupervised-clustering-and-supervised-classification" title="Permalink to this heading">¶</a></h4>
<section id="m2yd-model">
<h5 id="m2yd-model">M2YD model<a class="headerlink" href="#m2yd-model" title="Permalink to this heading">¶</a></h5>
<p>The M2YD model is an experimental (toy) DL model implemented in <code class="docutils literal notranslate"><span class="pre">DomId</span></code>, that simultaneously performs a supervised classification task (e.g., digit labels in color-MNIST) and an unsupervised clustering task (e.g., cluster the colors in color-MNIST).
Here is a basic example to run the M2YD model on the Color-MNIST dataset:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>poetry run python main_out.py --te_d 0 1 2 --tr_d 3 4 5 6 7 8 9 --task=mnistcolor10 --debug --epos=10 --aname=m2yd --zd_dim=7 --apath=domid/algos/builder_m2yd.py --gamma_y 1
</pre></div>
</div>
</section>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="references">
<h2 id="references">References<a class="headerlink" href="#references" title="Permalink to this heading">¶</a></h2>
<p>[1] Jiang, Zhuxi, et al. “Variational deep embedding: An unsupervised and generative approach to clustering.” IJCAI 2017. (<a class="reference external" href="https://arxiv.org/abs/1611.05148">https://arxiv.org/abs/1611.05148</a>)</p>
<p>[2] Kingma, Welling. “Auto-encoding variational bayes.” ICLR 2013. (<a class="reference external" href="https://arxiv.org/abs/1312.6114">https://arxiv.org/abs/1312.6114</a>)</p>
<p>[3] Xie, Girshick, Farhadi. “Unsupervised Deep Embedding for Clustering Analysis.” ICML 2016. (<a class="reference external" href="http://arxiv.org/abs/1511.06335">http://arxiv.org/abs/1511.06335</a>)</p>
<p>[4] Sidulova, Sun, Gossmann. “Deep Unsupervised Clustering for Conditional Identification of Subgroups Within a Digital Pathology Image Set.” MICCAI, 2023. (<a class="reference external" href="https://link.springer.com/chapter/10.1007/978-3-031-43993-3_64">https://link.springer.com/chapter/10.1007/978-3-031-43993-3_64</a>)</p>
<p>[5] Bo, Deyu, et al. “Structural deep clustering network.” Proceedings of the web conference 2020. 2020. (<a class="reference external" href="https://doi.org/10.1145/3366423.3380214">https://doi.org/10.1145/3366423.3380214</a>)</p>
<p>[6] Sidulova, Kahaki, Hagemann, Gossmann. “Contextual unsupervised deep clustering in digital pathology.” CHIL 2024.</p>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="index.html" title="Welcome to DomId’s documentation!"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Welcome to DomId’s documentation! </span>
              </div>
            </a>
          
          
            <a href="about_link.html" title="About DomId"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> About DomId </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2024, FDA/CDRH/OSEL/DIDSR..
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>